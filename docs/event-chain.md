# Event-chain
## The problem
The standard ink! contract typically runs on a substrate-based blockchain, where anyone can obtain and validate the emitted events by replaying the blocks with a local node. However, the Phala Phat Contract runs in Secure Enclave workers and for a given contracts it only runs on specified workers. Consequently, people can't just grab any worker to replay the blocks as they could with the original ink! contracts.

## The solution - Event Chain
In order to allow the external world to query the events produced during the execution of the Phat contract, we let pruntime emit the events in the form of logs during contract execution. We choose one or more workers from any cluster and save the event chain in its logs, which can be indexed by third-party services. To ensure the trustworthiness of the logs, we organize them in the form of a block chain, where each block contains all events in the body generated by a call. Additionally, each block header carries basic information like the block number and parent hash. Pruntime provides an API that can query the current latest event block header hash. Anyone can trace back through the latest header hash to verify the integrity of the entire event chain.

## Log format example
```
27633:2023-06-14T06:54:47.094931Z  INFO prpc{id=1453}:ecall:ocall: phactory::event_chain: number=46 payload=905e4367205d5a852c8bffdb6ad16fb435baab9dd56931d7a37cc8c6359100f92e000000000000009e00000001000000010000000c0202027d036356f407caf045728196c01e39a1af01c71846a1ca47fc73d561bb9f7842d43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d0088526a740000000000000000000000000204067d036356f407caf045728196c01e39a1af01c71846a1ca47fc73d561bb9f78427d036356f407caf045728196c01e39a1af01c71846a1ca47fc73d561bb9f784208814a4097fefe74549e375f6c94b7407190922078a579f86ac9faa7af200ad4b1814a4097fefe74549e375f6c94b7407190922078a579f86ac9faa7af200ad4b1020202d43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d7d036356f407caf045728196c01e39a1af01c71846a1ca47fc73d561bb9f7842d3620cea73000000000000000000000000
27646:2023-06-14T06:54:47.792065Z  INFO prpc{id=1453}:ecall:ocall: phactory::event_chain: number=47 payload=628df0c32ebf3f2349d1152e3ac66df980cb743231926bbe9e7658e33c0a71bd2f000000000000009f00000001000000010000000c0202027d036356f407caf045728196c01e39a1af01c71846a1ca47fc73d561bb9f7842d43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d0088526a740000000000000000000000000204067d036356f407caf045728196c01e39a1af01c71846a1ca47fc73d561bb9f78427d036356f407caf045728196c01e39a1af01c71846a1ca47fc73d561bb9f784208814a4097fefe74549e375f6c94b7407190922078a579f86ac9faa7af200ad4b1814a4097fefe74549e375f6c94b7407190922078a579f86ac9faa7af200ad4b1020202d43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d7d036356f407caf045728196c01e39a1af01c71846a1ca47fc73d561bb9f7842d3620cea73000000000000000000000000
```